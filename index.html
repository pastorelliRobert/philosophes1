<!DOCTYPE html>
<html>

<head>

	<meta charset="UTF-8">
	<title>Philosophes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
<style>


    /* Conteneur du bouton d'aide */
    #help-container {
        display: inline-block;
        margin-left: 10px; /* Espacement avec le bouton principal */
    }

    /* Style du bouton d'aide "?" */
    #help-button {
        width: 50px;
        height: 40px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        border-radius: 50%; /* Forme arrondie */
        background-color: green; 
        color: white;
        cursor: pointer;
        
    }

    /* Changement de couleur au survol */
    #help-button:hover {
        background-color: lightgreen; 
    }





/* Fond semi-transparent pour la pop-up */
.popup-overlay {
    display: none; /* Cach√© par d√©faut */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5); /* Assombrit l'√©cran */
    z-index: 1000;
}

/* Contenu de la pop-up */
.popup-content {
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
    font-size: 16px;
}

/* Style du texte */
.popup-content p {
    font-weight: bold;
    font-size: 12px;
    margin-bottom: 10px;
}

/* Liste dans la pop-up */
.popup-content ul {
    list-style: none;
    padding: 0;
}

.popup-content li {
    margin: 5px 0;
}

	 
	
	#search-button {
    background-color: lightblue;
    color: white;
    font-size: 12px;
    font-weight: bold;
    padding: 3px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

/* Effet au survol */
#search-button:hover {
    background-color: blue;
}
	
	
			
		/* Conteneur principal qui regroupe la liste et le graphe */
		#layout-container {
			display: flex;
			/* Active le mod√®le flexbox */
			flex-direction: row;
			/* Organise les √©l√©ments en ligne (horizontalement) */
			height: 100vh;
			/* Utilise toute la hauteur de la fen√™tre */
		}

		/* Conteneur de la liste des voisins */
		#neighbors-list {
			width: 320px;
			/* Largeur de la colonne des voisins */
			border: 1px solid gray;
			/* Bordure pour s√©parer visuellement */
			padding: 10px;
			/* Ajoute de l‚Äôespace int√©rieur */
			overflow-y: auto;
			/* Barre de d√©filement si la liste est trop longue */
			background-color: #f9f9f9;
			/* Fond l√©g√®rement gris√© */
		}
		
		#graph-title {
		text-align: center;
		font-size: 12px;
		font-weight: bold;
		color: black;
		padding: 10px;
		margin: 0;
		border-bottom: 2px solid #ddd; /* S√©paration avec les listes */
		}

		/* Conteneur Sigma.js */
		#sigma-container {
			flex-grow: 1;
			/* Le graphe occupe l'espace restant */
			border: 1px solid black;
			/* Bordure pour tester visuellement */
		}

		/* Style des √©l√©ments de la liste des voisins */
		#neighbors ul {
			list-style-type: none;
			/* Supprime les puces */
			padding: 0;
		}

		#neighbors li {
			margin-bottom: 5px;
			/* Espace entre les √©l√©ments */
		}

		#neighbors li:hover {
			background-color: #e0e0e0;
			/* Fond en survol */
			cursor: pointer;
			/* Curseur en main */
		}

		/* Style pour le bouton de rechargement */
		#reload-button { 
		position: fixed;
		top: 10px;
		right: 10px;
		background-color: blue !important; 
		color: white !important; /* Le texte en blanc pour contraste */
		border: none;
		padding: 10px 10px;
		font-size: 12px;
		font-weight: bold; /* Texte en gras */
		cursor: pointer;
		border-radius: 5px; 
		}

		/* Changement de couleur au survol */
		#reload-button:hover {
		background-color: #45a049 !important;
		}

		#reset-neighbors-graph {
    background-color: #007bff; /* Bleu */
    
   color: white; /* Texte en blanc */
    font-size: 10px; /* Taille du texte plus grande */
    font-weight: bold; /* Texte en gras */
    padding: 10px 10px; /* Espacement interne pour agrandir le bouton */
    border: none; /* Supprime la bordure */
    border-radius: 5px; /* Coins arrondis */
    cursor: pointer; /* Curseur en forme de main */
	margin-top: 10px;
    display: none; /* Toujours cach√© par d√©faut */
}

/* Effet au survol */
#reset-neighbors-graph:hover {
    background-color: #0056b3; /* Bleu plus fonc√© */
}


		/* Conteneur pour la recherche  */
		#search-container {
			flex-direction: column;
			/* Organise les √©l√©ments verticalement */
			gap: 5px;
			/* Augmentation de l'espacement vertical entre les √©l√©ments */
			align-items: center;
			margin-top: 10px; /* Ajoute une marge en haut pour s√©parer du bouton de rechargement */
			margin-bottom: 10px;
			/* Espace entre la recherche et les listes */
		}

		/* Champ de recherche */
		#node-search {
			flex: 1;
			/* Le champ de saisie occupe tout l‚Äôespace disponible */
			padding: 12px;
		}


		/* Message de recherche */
		#search-message {
			margin-top: 10px;
			color: red;
			/* Afficher les messages d'erreur en rouge */
			font-weight: bold;
		}
		
		#search-results {
    list-style-type: none;
    padding: 0;
    margin: 5px 0;
    max-height: 200px;
    overflow-y: auto;
    background: white;
    border: 1px solid #ccc;
    display: none; /* Cach√© par d√©faut */
    position: absolute;
    z-index: 1000;
    width: 200px; /* Ajuste la largeur selon besoin */
}


		
		.reload-btn {
		background-color: #007bff; /* Bleu */
		color: white;             /* Texte blanc */
		padding: 8px 10px;        /* Espacement int√©rieur */
		border: none;              /* Supprimer la bordure */
		border-radius: 5px;        /* Coins arrondis */
		cursor: pointer;     /* Curseur en forme de main */
		margin-top: 10px;		
		font-size:12px;           /* Taille de la police */
		transition: background-color 0.3s ease; /* Animation du changement de couleur */
		}
		
		/* Effet au survol */
		.reload-btn:hover {
		background-color: blue; /* Bleu plus fonc√© au survol */
		}
		
		.toggle-btn {
		background-color: lightblue; /* Bleu */
		color: white;             /* Texte blanc */
		padding: 5px 10px;        /* Espacement int√©rieur */
		border: none;              /* Supprimer la bordure */
		border-radius: 5px;        /* Coins arrondis */
		cursor: pointer;     /* Curseur en forme de main */
		margin-top: 10px;		
		font-size:10px;           /* Taille de la police */
		transition: background-color 0.3s ease; /* Animation du changement de couleur */
		}

		/* Effet au survol */
		.toggle-btn:hover {
		background-color: #0056b3; /* Bleu plus fonc√© au survol */
		}

		/* Style lorsque le bouton est enfonc√© */
		.toggle-btn:active {
		background-color: #003f7f;
		}

		/* Style pour d√©sactiver le bouton */
		.toggle-btn:disabled {
		background-color: #cccccc;
		cursor: not-allowed;
		}
		
		#node-info {
		position: absolute;
		background: rgba(255, 255, 255, 0.99); /* Fond blanc opaque √† 99% */
		color: black; /* Texte en noir pour plus de lisibilit√© */
		border: 2px solid #333; /* Bordure l√©g√®rement fonc√©e */
		padding: 8px;
		border-radius: 5px;
		box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3); /* Ajout d'une ombre pour un effet visuel sympa */
		font-size: 12px;
		max-width: 250px; /* √âvite que la bo√Æte soit trop large */
		z-index: 1000; /* Toujours au-dessus des autres √©l√©ments */
		display: none; /* Cach√© par d√©faut */
		 transform: translateY(15px); /* ‚úÖ D√©cale la bo√Æte 15px vers le bas */
		}
		
		.node-highlight {
		color: red !important;
		font-size: 22px !important;
		font-weight: bold !important;
		transition: color 0.3s ease-in-out, font-size 0.3s ease-in-out;
		}

#left-column {
    width: 300px; /* Largeur fixe de la colonne */
    display: flex;
    flex-direction: column;
    padding: 10px;
    background-color: #f9f9f9; /* Fond clair */
    border-right: 2px solid #ddd; /* S√©paration avec le graphe */
}

#philosopher-info {
	 max-width: 80%; /* R√©duit la largeur pour √©viter de toucher le bord */
    padding: 8px;
    border: 2px solid #333; /* Bordure visible */
    background-color: #fff; /* Fond blanc */
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    color: black;
    border-radius: 8px;
    margin-bottom: 10px; /* Espacement avec la liste des voisins */
	margin-left: auto; /* Centrage horizontal */
    margin-right: auto; /* Centrage horizontal */
}

#philosopher-info a {
    color: red;
    font-size: 18px;
    font-weight: bold;
    text-decoration: none;
}

#philosopher-info img {
    width: 30px;
    height: 30px;
    margin-left: 8px;
    vertical-align: middle;
}



#search-input {
    width: 98%;
    height: 60px; /* Permet plusieurs lignes */
    font-size: 14px;
    padding: 5px;
    resize: vertical; /* Permet √† l'utilisateur d'agrandir si n√©cessaire */
}

/* üìå Am√©lioration du style du cadre de filtrage */
#filter-container {
    margin-bottom: 10px;
    padding: 15px;
    border: 2px solid #0073e6;
    background-color: #f0f8ff; /* Bleu tr√®s clair */
    border-radius: 8px;
    width: 270px;
    text-align: left;
}

/* üìå Style du titre (legend) */
#filter-container legend {
    font-size: 16px;
    font-weight: bold;
    color: #0056b3;
    padding: 5px;
}

/* üìå Alignement et taille des champs de saisie */
#filter-container label {
    display: inline-block;
    width: 100px; /* Meilleur alignement */
    text-align: right;
    margin-right: 10px;
    font-weight: bold;
}

#filter-container input {
    width: 60px;
    font-size: 14px;
    padding: 5px;
    text-align: center;
}

/* üìå Am√©lioration des boutons */
#filter-container button {
    background-color: lightblue;
    color: white;
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-size: 12px;
    margin-left: 5px;
}

#filter-container button:hover {
    background-color: blue;
}

/* üìå Espacement de l'op√©rateur de filtrage */
#operator {
    font-size: 28px;
    padding: 4px;
    width: auto;
    color: red;
    margin-top: 1px; /* Ajoute un espacement */
	margin-left: 80px;
}

#operator option {
    font-size: 28px;
    color: red;
}
/* üìå Conteneur de l‚Äôop√©rateur */
.filter-operator-container {
    display: flex;
    align-items: center;  /* Alignement vertical */
    justify-content: flex-start;
    margin-top: 5px;  /* Ajoute un petit espacement au-dessus */
}

/* üìå Ajustement du label de l'op√©rateur */
.filter-operator-label {
    width: 50px;  /* Ajuste l'espace occup√© par le label */
    text-align: center;
    font-weight: bold;
    margin-right: 0px;
}

/* üìå Ajustement du select */
#operator {
    padding: 4px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 14px;
    background-color: lightblue;
}





/* üìå Conteneur des boutons d‚Äôop√©rateurs */
.operator-buttons {
    display: flex;  /* Aligne les boutons horizontalement */
    gap: 5px;  /* Espacement entre les boutons */
}


/* üìå Style des boutons */
.operator-btn {
    padding: 8px 12px;
    font-size: 16px;
    font-weight: bold;
    border: 2px solid #999;
    border-radius: 5px;
    background-color: lightblue;  /* Couleur par d√©faut */
    color: black;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
}

/* üìå Style du bouton actif */
.operator-btn.selected {
    background-color: darkblue !important; /* Forcer la couleur */
    color: white !important;
    border-color: navy !important;
}



	</style>


</head>

<body>

<!-- CHARGEMENT BIBLIOS -->

	<!-- chargement local des bibliotheques qui ont √©t√© t√©l√©charg√© dans le dossier js -->
	<!--<script src="js/graphology.umd.min.js"></script> -->

	<script src="https://unpkg.com/graphology@0.25.2/dist/graphology.umd.min.js"></script>

   <!--  <script src="https://unpkg.com/graphology-traversal/dist/graphology-traversal.min.js"></script>  -->


	<!--  chargement par internet   -->
	<!--  <script src="https://cdn.jsdelivr.net/npm/sigma@2.3.0/build/sigma.min.js"></script>   -->

	<script src="https://unpkg.com/sigma@2.3.0/build/sigma.min.js"></script>

	
	<!-- LES DONN√âES xxxxx.JSON SONT DANS LE DOSSIER JS  -->


	<div id="layout-container">
		
		<div id="neighbors-list">
		

		
			<button class= "reload-btn" onclick="reloadPage()">Revenir au graphe initial complet</button>
			
			<!-- <button class="toggle-btn" onclick="toggleLabels()">Afficher/Masquer d√©tails</button>  ABANDON -->
			
			<div id="help-container">
			<button id="help-button" title="Informations">?</button>
			</div>
			
			
			<div id="node-info" style="position: absolute; top: 92px; left: 15px; width : 150; background: rgba(255, 255, 255, 0.9); border: 4px solid #ccc; padding: 10px; border-radius: 5px; display: none;">
			</div>


			<div id="fixed-header">
				<div id="search-container">
					<input type="text" id="node-search" placeholder="Nom d'un philosophe" />
					<ul id="search-results" style="list-style-type: none; padding: 0; margin: 0px 0; max-height: 160px; overflow-y: auto; background: white; border: 2px solid #ccc; display: block;"></ul>
					<button id="search-button"> üîçRechercher</button>
					

				</div>
			</div>
			
			 
	
	
	<!-- Zone de saisie pour le filtrage avec un titre -->

	<fieldset id="filter-container">
    <legend><b>üéØ Filtrage du graphe affich√©</b></legend>

    <label>Relations :</label>
    <input type="number" id="degree-total-input" min="0" max="999" placeholder="0-999">
    <button id="filter-degree-total">üîç Filtrer</button><br>

    <label>Influenceurs :</label>
    <input type="number" id="degree-in-input" min="0" max="999" placeholder="0-999">
    <button id="filter-degree-in">üîç Filtrer</button><br>

    <label>Influenc√©s :</label>
    <input type="number" id="degree-out-input" min="0" max="999" placeholder="0-999">
    <button id="filter-degree-out">üîç Filtrer</button><br>

    <label>Groupe n¬∞ :</label>
    <input type="number" id="modularity-class-input" min="0" max="20" placeholder="0-20">
    <button id="filter-modularity">üîç Filtrer</button><br>

    <!-- üìå Nouveau filtre pour l'ann√©e de naissance -->
    <label>Ann√©e :</label>
    <input type="number" id="year-input"   max="2024" >
    <button id="filter-year">üîç Filtrer</button><br>
	
	<!-- üìå Ajout de l'op√©rateur dans le cadre -->
    <div class="filter-operator-container">
    <label class="filter-operator-label">üîª Filtrage avec :</label>
    <div class="operator-buttons">
        <button class="operator-btn" data-operator="=">=</button>
        <button class="operator-btn" data-operator=">">></button>
        <button class="operator-btn" data-operator="<"><</button>
    </div>
</div>

	
	</fieldset>








			<button id="reset-neighbors-graph" style="display: none;">Revenir au graphe des voisins</button>

			<div id="search-message"></div>
			<h2 id="graph-title" style="text-align: center; margin-bottom: 10px;"></h2>
			

		
			
			<div id="left-column">
				<!-- ‚úÖ Nouveau placement du cadre Philosophe -->
				<div id="philosopher-info"></div>

				<!-- ‚úÖ Liste des voisins -->
				<h3>Voisins de : <span id="clicked-node-label">  </span></h3>
				<h4>Influenceurs (rouges) :</h4>
				<ul id="influencers-list"></ul>
				<h4>Influenc√©s (bleus) :</h4>
				<ul id="influenced-list"></ul>
			</div>
				
		
		</div>

		<div id="sigma-container"></div>
			
		<!-- Cadre sp√©cifique pour afficher le philosophe et son lien -->
		<div id="philosopher-info"></div>


	</div>
		
<script>
	
	// Recharge la page actuelle pour revenir au graphe complet
	function reloadPage() {
        location.reload();
		
		// cacher le bouton "Revenir au graphe des voisins" 
	document.getElementById("reset-neighbors-graph").style.display = "none";
	
    }
	
	let renderer; // D√©clare renderer avec une port√©e globale
	
	let lastNeighborsGraph = null; // Stocke le dernier sous-graphe des voisins
	let lastClickedNode = null; // Stocke le dernier philosophe s√©lectionn√©

	
	document.addEventListener("DOMContentLoaded", () => {
		document.getElementById("philosopher-info").textContent = "Cliquez sur un point du graphe"; // Texte au d√©marrage
	});

	 
	// D√©clarer le graphe principal avec une port√©e globale  
    const maingraph = new window.graphology.Graph();	
	
	let epaisseuredge = 1.00001 ;
	
///////// FONCTION POUR ATTACHER LES √âCOUTEURS D'√âV√âNEMENTS : CLIC SUR NODE
/////////	permet de recliquer sur les noeuds du sousgraphe 
/////////   dans lequel cette fonction est appel√©e 
    
	function attachEventListeners() {
        // √âcouteur pour les clics sur les n≈ìuds
		renderer.on('clickNode', (event) => {
                const nodeId = event.node; // ID du n≈ìud cliqu√©
				 // Obtenir le label du n≈ìud
                const clickedNodeLabel = renderer.graph.getNodeAttribute(nodeId, 'label');
				console.log ("node cliqu√© = ", nodeId);


		// üìå Mise √† jour du titre "Voisins de :"
			const clickedNodeLabelElement = document.getElementById('clicked-node-label');
			clickedNodeLabelElement.textContent = clickedNodeLabel || `Node ${nodeId}`;

		// üìå Mise √† jour du cadre d√©di√© √† l'affichage du philosophe
			const philosopherInfoElement = document.getElementById('philosopher-info');

		// üí° Supprimer l'ann√©e du label
			const cleanedLabel = clickedNodeLabel.replace(/^\d+\s*/, ""); 

			// üîç V√©rifications console
			console.log("Label nettoy√© :", cleanedLabel);
			console.log("URL Wikipedia :", `https://fr.wikipedia.org/wiki/${encodeURIComponent(cleanedLabel)}`);

   // if (cleanedLabel) {
        // üõ† Cr√©ation du lien Wikip√©dia
        const wikiLink = document.createElement("a");
        wikiLink.href = `https://fr.wikipedia.org/wiki/${encodeURIComponent(cleanedLabel)}`;
        wikiLink.target = "_blank"; // Ouvre dans un nouvel onglet
        wikiLink.textContent = cleanedLabel;
        
        // ‚úÖ Appliquer des styles au lien
        wikiLink.style.color = "red";
        wikiLink.style.fontSize = "22px";
        wikiLink.style.fontWeight = "bold";
        wikiLink.style.textDecoration = "none";

        // üèõ Ajout de l'ic√¥ne Wikip√©dia
        const wikiIcon = document.createElement("img");
        wikiIcon.src = "https://upload.wikimedia.org/wikipedia/commons/6/63/Wikipedia-logo.png";
        wikiIcon.alt = "Wikipedia";
        wikiIcon.style.width = "18px";
        wikiIcon.style.height = "18px";
        wikiIcon.style.marginLeft = "8px";
        wikiIcon.style.verticalAlign = "middle";

        wikiLink.appendChild(wikiIcon); // Ajoute l'ic√¥ne au lien

        // ‚úÖ Met √† jour le cadre `#philosopher-info` sans toucher "Voisins de :"
	   philosopherInfoElement.innerHTML = "";  // Efface le contenu pr√©c√©dent
	   philosopherInfoElement.appendChild(wikiLink); // Ajoute le lien dans le cadre

			// üñ• V√©rification console
			console.log("Philosophe affich√© :", philosopherInfoElement.innerHTML);
		//} 
		//else {
       //		 philosopherInfoElement.textContent = "Aucun philosophe s√©lectionn√©.";
		//}
			console.log ("nodeId =",nodeId);
			
			// Appeler la fonction listevoisins
            listevoisins(nodeId);
            // Appeler la fonction displaySubgraph avec l'ID du n≈ìud cliqu√©
            displaySubgraph(nodeId);
			//appeler la fonction sousgraphe par attribut  
			
			 
        });
	}// FIN DE LA FONCTION ATTACHEVENTLISTENERS 
	
	
/////// ECOUTEUR DU SURVOL DUN NOEUD	////////////////////////////////		
function attachHoverEvents() {
	renderer.on('enterNode', (event) => 
	{
		const nodeId = event.node; // ID du n≈ìud survol√©
		const nodeAttributes = renderer.getGraph().getNodeAttributes(nodeId); // Attributs du n≈ìud
		console.log ("nodeAttributes",nodeAttributes);
		// Construire le contenu √† afficher
			//<strong>Label:</strong> ${nodeAttributes.label || 'N/A'}<br>
			
		const infoHTML = `
			
					<strong>Relations:</strong> ${nodeAttributes.attributes?.['Degr√©'] ?? 'N/A'}<br> 
					<strong>Influenceurs:</strong> ${nodeAttributes.attributes?.['Degr√© Entrant'] ?? 'N/A'}<br>
					<strong>Influenc√©s:</strong> ${nodeAttributes.attributes?.['Degr√© Sortant'] ?? 'N/A'}<br>
					<strong>Groupe n¬∞:</strong> ${nodeAttributes.attributes?.['Modularity Class'] ?? 'N/A'}<br>
		`;

		// Afficher les informations dans le conteneur
		const infoContainer = document.getElementById('node-info');
		infoContainer.innerHTML = infoHTML;
		infoContainer.style.display = 'block';
	});	// FIN DE L'ENTR√âE SUR LE NOEUD
	
	// SORTIE DU NOEUD
	renderer.on('leaveNode', () =>
	{
		// Masquer les informations lorsque la souris quitte le n≈ìud
		const infoContainer = document.getElementById('node-info');
		infoContainer.style.display = 'none';
	}); // 	FIN DE SORTIE DU NOEUD
	
} // FIN FONCTION attachHoverEvents  SURVOL DE NODES
			
	
	document.addEventListener("DOMContentLoaded", () => {
    const operatorButtons = document.querySelectorAll(".operator-btn");

    // ‚úÖ S√©lection par d√©faut : "=" activ√© au d√©part
    let selectedOperator = "=";
    const defaultButton = document.querySelector('.operator-btn[data-operator="="]');
    if (defaultButton) {
        defaultButton.classList.add("selected");
    }

    operatorButtons.forEach(button => {
        button.addEventListener("click", () => {
            // ‚úÖ Retirer la classe "selected" de tous les boutons
            operatorButtons.forEach(btn => btn.classList.remove("selected"));

            // ‚úÖ Ajouter la classe "selected" au bouton cliqu√©
            button.classList.add("selected");

            // ‚úÖ Mettre √† jour l‚Äôop√©rateur s√©lectionn√©
            selectedOperator = button.dataset.operator;
            console.log(`Op√©rateur s√©lectionn√© : ${selectedOperator}`);
        });
    });
});

	
	
	
	//////////////////////////////////////////////////////////////////////////////////////////
	//FONCTION AFFICHAGE DU SOUS GRAPHE DES VOISINS DU NOEUD CLIQU√â, voisins dans le graphe principal "maingraph" 
	// declar√©e au debut du script pour avoir une port√©e globale cad pouvoir etre appel√©e de n'importe o√π
	function displaySubgraph(nodeId) {
    //console.log('displaySubgraph called with nodeId:', nodeId);
	
	 // R√©initialiser le conteneur des informations affich√©es
    const infoContainer = document.getElementById('node-info');
    if (infoContainer) {
        infoContainer.style.display = 'none'; // Masquer le conteneur
        infoContainer.innerHTML = '';        // Effacer le contenu
    }

 // V√©rifier si un renderer existe d√©j√†, et le supprimer
    if (renderer) { renderer.kill(); renderer = null; }

    // Cr√©er une nouvelle instance de graphe pour le sous-graphe
    const subgraph = new window.graphology.Graph();
   // console.log(maingraph.getNodeAttributes(nodeId));
	 
    // Ajouter le n≈ìud central au sous-graphe
    subgraph.addNode(nodeId, {
        ...maingraph.getNodeAttributes(nodeId),
        color: 'black',    // Le n≈ìud central est noir
		size: 65,          // Augmenter significativement la taille du n≈ìud
		label: maingraph.getNodeAttribute(nodeId, 'label') || `Node ${nodeId}`,  
		labelSize: 38,     // Augmenter la taille du label
		forceLabel: true   // Force l'affichage du label
    });
	
	const nodecentral = nodeId ;
	
	//console.log ("id du noeud central", nodecentral);
	
	
	
		
   // Ajouter les voisins avant d'ajouter les ar√™tes
    maingraph.forEachNeighbor(nodeId, (neighbor) => {
        if (!subgraph.hasNode(neighbor)) {
            subgraph.addNode(neighbor, {
                ...maingraph.getNodeAttributes(neighbor),
                color: 'gray'  // Couleur par d√©faut temporaire pour √™tre mise √† jour apr√®s
            });
        }
    });

    // Ajouter les ar√™tes apr√®s s'√™tre assur√© que les n≈ìuds existent
    maingraph.forEachNeighbor(nodeId, (neighbor) => {
        let color;

        if (maingraph.hasEdge(nodeId, neighbor)) {
            color = 'lightblue';  // Si l'ar√™te part du n≈ìud central vers le voisin
            subgraph.addEdge(nodeId, neighbor, { color });
        }
        if (maingraph.hasEdge(neighbor, nodeId)) {
            color = 'pink';  // Si l'ar√™te vient du voisin vers le n≈ìud central
            subgraph.addEdge(neighbor, nodeId, { color });
        }

        // Mettre √† jour la couleur du voisin selon la direction de l'ar√™te
        subgraph.setNodeAttribute(neighbor, 'color', color);
    });
	
    // R√©cup√©rer le conteneur du graphe
    const container = document.getElementById('sigma-container');

    // Effacer tout le contenu existant
    container.innerHTML = '';

     // Initialiser Sigma avec le sous-graphe et des param√®tres pour agrandir les labels
    renderer = new window.Sigma(subgraph, container, {
		defaultNodeColor: '#FF5733',
		//defaultEdgeColor: '#3498DB',
    
		labelSize: 22,              // Taille de base des labels
		labelSizeRatio: 4.0 ,         // Ratio pour ajuster les labels selon la taille des n≈ìuds
		labelThreshold: 1,           // Toujours afficher les labels en fonction du niveau de zoom
		font: 'Arial',               // Utilisation d'une police lisible
		// Faire en sorte que Sigma prenne en compte la couleur du label depuis l'attribut du n≈ìud
		EdgeColor: { by: 'node', attribute: 'color', default: 'blue' },
		minNodeSize: 5,              // Taille minimale des n≈ìuds pour √©viter qu'ils disparaissent
		maxNodeSize: 30,             // Taille maximale pour √©viter qu'ils deviennent trop grands
		minEdgeSize: 1,               // Taille minimale des ar√™tes
		maxEdgeSize: 5,               // Taille maximale des ar√™tes
		zoomingRatio: 1.1,            // R√©glage du zoom plus fin
		enableEdgeHovering: true,      // Activer le survol des ar√™tes
		enableEdgeLabel: true,        // Afficher les labels des ar√™tes si n√©cessaire
		renderLabels: true,           // Forcer l'affichage des labels
		labelRenderedSizeThreshold: 0 // Supprimer le seuil de taille minimal pour afficher tous les labels
	
	});

	subgraph.forEachNode((node) => {
		subgraph.setNodeAttribute(node, 'size', subgraph.getNodeAttribute(node, 'size') || 10);
		subgraph.setNodeAttribute(node, 'forceLabel', true);
		subgraph.setNodeAttribute(nodeId, "labelSize", 18); // Ajuste la taille des labels apr√®s filtrage
	});
	renderer.getGraph().forEachNode((node) => {
		renderer.getGraph().setNodeAttribute(node, 'size', 8); // Taille par d√©faut

		if (node === nodecentral) {
			renderer.getGraph().setNodeAttribute(node, 'size', 24);  // Taille du n≈ìud central
			renderer.getGraph().setNodeAttribute(node, 'color', 'black'); // Couleur du n≈ìud central
			renderer.getGraph().setNodeAttribute(node, 'labelColor', 'red');  // couleur du label
			renderer.getGraph().setNodeAttribute(nodecentral, 'LabelSize', 20);  // Taille du label personnalis√©e ne fonctionne pas 
    }
	});
	
	//titre du graphe
	document.getElementById('graph-title').textContent = `Graphe des voisins de ${renderer.getGraph().getNodeAttribute(nodeId, 'label-court')} =>`;
	
	lastClickedNode = nodeId; // M√©morise le philosophe central
    lastNeighborsGraph = new graphology.Graph(); // Initialise un nouveau graphe vide


function applyCircularLayout(graph) {
    const nodes = graph.nodes();
    const totalNodes = nodes.length;
    const radius = Math.max(150, totalNodes * 10); // Plus de n≈ìuds = plus grand rayon

    nodes.forEach((nodeId, index) => {
        const angle = (index / totalNodes) * 2 * Math.PI;
        graph.setNodeAttribute(nodeId, "x", Math.cos(angle) * radius);
        graph.setNodeAttribute(nodeId, "y", Math.sin(angle) * radius);
    });
}

// Appliquer la spatialisation circulaire apr√®s la cr√©ation du graphe des voisins
applyCircularLayout(subgraph);
renderer.refresh();



    // Copier les n≈ìuds du sous-graphe actuel
    subgraph.forEachNode((nId, attributes) => {
    lastNeighborsGraph.addNode(nId, { ...attributes });
    });

    // Copier les ar√™tes du sous-graphe actuel
    subgraph.forEachEdge((eId, attributes, source, target) => {
    lastNeighborsGraph.addEdge(source, target, { ...attributes });
    });

   
   

   
   
   
	renderer.refresh();

    //console.log('Sous-graphe des voisins affich√©');
	
		
	// R√©attachement des √©v√©nements apr√®s affichage du sous-graphe
	attachEventListeners();
	attachHoverEvents();
				
	}; //----------------------------------------- FIN DE FUNCTION DISPLAYSUBGRAPH
	///////////////////////////////////////////////////////////////////////////////
	
	///////////////////////////////////////////////////////////////////////
	///////RESTAURER LE GRAPHE DES VOISINS
	
	function restoreLastNeighborsGraph() {
    if (!lastNeighborsGraph || !lastClickedNode) {
        alert("Aucun graphe des voisins enregistr√© !");
        return;
    }

    console.log(`üîÑ Restauration du graphe des voisins pour ${lastClickedNode}`);

    const container = document.getElementById('sigma-container');
    container.innerHTML = ''; // Efface le graphe filtr√©

	// cacher le bouton "Revenir au graphe des voisins" 
	document.getElementById("reset-neighbors-graph").style.display = "none";

    // Restaurer le dernier sous-graphe enregistr√©
    renderer = new window.Sigma(lastNeighborsGraph, container);

    // R√©attacher les √©v√©nements de survol et de clic apr√®s restauration
    attachEventListeners();
    attachHoverEvents();
}
/////////////////////////////////////////////////////////////
	

document.getElementById("reset-neighbors-graph").addEventListener("click", restoreLastNeighborsGraph);



	
	//Fonction pour mettre √† jour les listes de voisins
	function updateNeighborList(label, nodeId, influencersList, influencedList) {
    const influencerItems = influencersList.getElementsByTagName('li');
    const influencedItems = influencedList.getElementsByTagName('li');

    for (let item of influencerItems) {
        if (item.getAttribute('data-node-id') === nodeId.toString()) {
            item.textContent = label;  // Mise √† jour du texte dans la liste des influenceurs
        }
    }

    for (let item of influencedItems) {
        if (item.getAttribute('data-node-id') === nodeId.toString()) {
            item.textContent = label;  // Mise √† jour du texte dans la liste des influenc√©s
        }
    }
}  // fin de la fonction updateNeighborList

	
	
////////////////////////////////////////////////////////////////////////	
//// FONCTION LISTES DES VOISINS
	function listevoisins(nodeId) {
    // Obtenir le label du n≈ìud cliqu√©
    const clickedNodeLabel = maingraph.getNodeAttribute(nodeId, 'label'); 
    const clickedNodeLabelElement = document.getElementById('clicked-node-label');
    clickedNodeLabelElement.textContent = clickedNodeLabel || `Node ${nodeId}`;

    // R√©cup√©rer toutes les ar√™tes associ√©es au n≈ìud cliqu√©
    const edges = maingraph.edges(nodeId);

    // Initialiser les listes pour les influenceurs et influenc√©s
    const influencersList = document.getElementById('influencers-list');
    const influencedList = document.getElementById('influenced-list');

    influencersList.innerHTML = ''; // R√©initialise la liste des influenceurs
    influencedList.innerHTML = '';  // R√©initialise la liste des influenc√©s

    let influencers = [];
    let influenced = [];

    // Parcourt les ar√™tes pour classer les voisins
    edges.forEach(edgeId => {
        const source = maingraph.source(edgeId);  // Source de l'ar√™te
        const target = maingraph.target(edgeId);  // Cible de l'ar√™te

        if (target === nodeId) {
            // Ajouter √† la liste des influenceurs avec l'ann√©e de naissance
            const influencerLabel = maingraph.getNodeAttribute(source, 'label') || `Node ${source}`;
            const birthYear = parseInt(influencerLabel.split(' ')[0]) || 9999;  // Extraction de l'ann√©e
            influencers.push({ id: source, label: influencerLabel, year: birthYear });
        } else if (source === nodeId) {
            // Ajouter √† la liste des influenc√©s avec l'ann√©e de naissance
            const influencedLabel = maingraph.getNodeAttribute(target, 'label') || `Node ${target}`;
            const birthYear = parseInt(influencedLabel.split(' ')[0]) || 9999;  // Extraction de l'ann√©e
            influenced.push({ id: target, label: influencedLabel, year: birthYear });
        }
    });

    // Trier les listes par ann√©e de naissance croissante
    influencers.sort((a, b) => a.year - b.year);
    influenced.sort((a, b) => a.year - b.year);

    // Ajouter les influenceurs tri√©s dans la liste HTML
    influencers.forEach((influencer) => {
        const li = document.createElement('li');
        li.textContent = influencer.label;
        li.setAttribute('data-node-id', influencer.id);
        influencersList.appendChild(li);
    });

    // Ajouter les influenc√©s tri√©s dans la liste HTML
    influenced.forEach((influencedNode) => {
        const li = document.createElement('li');
        li.textContent = influencedNode.label;
        li.setAttribute('data-node-id', influencedNode.id);
        influencedList.appendChild(li);
    });
} // FIN DE LA FONCTION LISTE DES VOISINS
//////////////////////////////////////////////////////////////////////
		
		
	// CHARGEMENT DES DONN√âES ET CONSTRUCTION DU GRAPHE DES VOISINS

	// Attendre que le DOM soit compl√®tement charg√©  
	document.addEventListener('DOMContentLoaded', () => {  // ferm√© en derniere ligne du script
		
		
		// verifications du chargement de Sigma
		if (window.Sigma) {
				//console.log("Sigma.js est bien charg√© ");
				//console.log("Propri√©t√©s disponibles dans Sigma.js :", Object.keys(window.Sigma));
		} else {console.log("Sigma.js n'est pas charg√© !");	};
			// essai pour avoir la version de sigma (pas tjs pr√©sente)
			//if ( window.Sigma.version) {console.log("Version de Sigma.js :", window.Sigma.version);} 
			//else {console.log("Impossible de d√©tecter la version de Sigma.js");	};
	
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////// UTILISATION DE FETCH POUR CHARGER LES DONN√âES DEPUIS LE DOSSIER ./js
		fetch('graphe_louvain_3size.json')
		.then(response => {
				// V√©rifier si la r√©ponse est obtenue
				if (!response.ok) { console.log("pas de reponse √† fetch" );	}				
				// Parser la r√©ponse JSON qui va devenir un ogjet javascript utilisable
				return response.json();
		})
		
		.then(data =>
		{   
			try 
			{  								//utilisation de maingraph d√©clar√© global
				// IT√âRER SUR LES N≈íUDS
				data.nodes.forEach(node =>
				{
					if (!node.id) {
						console.error(`Node is missing   id. Skipping.`);
						return;
					}
					// Convertir les coordonn√©es x et y en nombres flottants
						node.x = parseFloat(node.x);
						node.y = parseFloat(node.y);
						//console.log("N≈ìud actuel :", node);

	
					// Mise √† jour du label avec des attributs suppl√©mentaires existant dans les data
						//const degreeIn = node['Degr√© Entrant'] || 'N/A';
						//const degreeOut = node['Degr√© Sortant'] || 'N/A';
						const degreeIn = node.attributes?.['Degr√© Entrant'] || 'N/A';
						const degreeOut = node.attributes?.['Degr√© Sortant'] || 'N/A';
						const degree = node.attributes?.['Degr√©'] || 'N/A';
						const modularityClass = node.attributes?.['Modularity Class'] || 'N/A';

//console.log(`Noeud ${node.label} - Degr√© Entrant:`, degreeIn);
//console.log(`Noeud ${node.label} - Degr√© Sortant:`, degreeOut);
//console.log(`Noeud ${node.label} - Degr√©:`, degree);
//console.log(`Noeud ${node.label} - Modularity Class:`, modularityClass);

						
						// Stocker les labels court et long
						node['label-court'] = node.label;  
						node['label-long'] = `${node.label}, In ${degreeIn}, Out ${degreeOut}  `;

						// Par d√©faut, afficher le label court
						node.label = node['label-court'];
								
						// Ajouter le n≈ìud au graphe
							maingraph.addNode(node.id, node);
							//console.log("tyty",node); // Should print the node
							
				
  		
							
							
				});
							
								
				// IT√âRER SUR LES AR√äTES
				data.edges.forEach(edge =>
				{
					if (!edge.source || !edge.target) {
						console.error(`Edge is missing source or target. Skipping.`);
						return;
					}
			 epaisseuredge = maingraph.getNodeAttribute(edge.source, "size")	;
			//console.log(epaisseuredge);
			const sourceColor = maingraph.getNodeAttribute(edge.source, "color") || "#AAAAAA";
			//console.log("Couleur du n≈ìud source :", sourceColor);

						
					// AJOUTER LES ANN√âES DE NAISSANCE AUX N≈íUDS SOURCE ET TARGET
						//maingraph.setNodeAttribute(edge.source, 'birthYear', edge.ans || 'N/A');
						//maingraph.setNodeAttribute(edge.target, 'birthYear', edge.ant || 'N/A');
					maingraph.setNodeAttribute(edge.source, 'birthYear', edge.attributes?.ans || 'N/A');
					maingraph.setNodeAttribute(edge.target, 'birthYear', edge.attributes?.ant || 'N/A');

					//console.log(`Noeud ${edge.source} - birthYear:`, maingraph.getNodeAttribute(edge.source, 'birthYear'));
					//console.log(`Noeud ${edge.target} - birthYear:`, maingraph.getNodeAttribute(edge.target, 'birthYear'));

					// Ajouter l'ar√™te au graphe avec les attributs
					maingraph.addEdge(edge.source, edge.target,
					{
						type: 'arrow', // Type d'ar√™te (fl√®che)
			size: epaisseuredge/100 , // Contr√¥le direct de l'√©paisseur (en pixels)					
			color: sourceColor, // Appliquer la couleur du n≈ìud source √† l‚Äôar√™te
						
						//color: 'lightblue', // Couleur de l'ar√™te
						...edge.attributes || {} // Propagation des attributs optionnels de l'ar√™te
												//ou un objet vide pour √©viter les erreurs
					});
						//console.log("edge",edge); // Should print the edge
				});
								
			// ITERER A NOUVEAU SUR LES NOEUD POUR AJOUTER BIRTHYEAR QUI A √âT√â CR√â√â DANS LA BOUCLE DES EDGE
				data.nodes.forEach(node =>
				{ 
					// R√©cup√©rer l'ann√©e de naissance ajout√©e depuis les ar√™tes
					//et redefinir les autres attributs
					const An = node['birthYear'] || 'N/A';
						const degreeIn = node.attributes?.['Degr√© Entrant'] || 'N/A';
						const degreeOut = node.attributes?.['Degr√© Sortant'] || 'N/A';
						const degree = node.attributes?.['Degr√©'] || 'N/A';
						const modularityClass = node.attributes?.['Modularity Class'] || 'N/A';

					// Mise √† jour du label avec l'ann√©e au d√©but
					node.label = `${An} ${node.label}`;

					// Mise √† jour du label long en ajoutant toutes les informations
					node['label-long'] = `${node.label}, An ${An}, In ${degreeIn}, Out ${degreeOut}, Class ${modularityClass} `;
					//console.log( node['label-long'] );
					
					 
				});

				// R√©cup√©rer le conteneur du graphe
					const container = document.getElementById('sigma-container');
			
				// Cr√©er le rendu Sigma.js
					renderer = new window.Sigma.Sigma( maingraph, container,
					{    
							//minEdgeSize: epaisseuredge, // Taille minimale des ar√™tes (pour une taille constante)
							// maxEdgeSize: epaisseuredge, // Taille maximale des ar√™tes (pour une taille constante)
							//defaultEdgeType: "arrow", // Type d'ar√™te par d√©faut
						 
						 
					});
					//console.log("Renderer cr√©√© :", renderer); // V√©rification ABSOLUMENT cruciale
					if (!renderer) {
					console.error("Le rendu n'a pas √©t√© cr√©√© ! V√©rifiez le conteneur et l'initialisation de Sigma.")};
		
				renderer.getGraph().forEachEdge((edge, attributes) => {
    if (typeof attributes.color === "string" && attributes.color.startsWith("rgb")) {
        // Transformer la couleur RGB en RGBA avec opacit√© r√©duite
        attributes.color = attributes.color.replace("rgb", "rgba").replace(")", ", 0.4)");
    }
});
renderer.refresh();

renderer.setSetting("labelThreshold", 0.01); // Les labels apparaissent plus t√¥t NON ne fonctionne pas 
renderer.refresh();

 


	
	// ‚úÖ R√©attacher les √©v√©nements pour permettre le survol et le clic
    attachEventListeners();
	attachHoverEvents();
	
	////////////////////////////////////////////////////////////////////
	//Fonction de filtrage √† ajouter apr√®s l'initialisation du graphe

	function filterGraph(attribute, value) {
    
	if (!value) {
        alert(`Veuillez entrer une valeur.`);
        return;
    }
	
    //const operator = document.getElementById("operator").value; // R√©cup√®re l‚Äôop√©rateur s√©lectionn√© (=, > ou <)
    // üìå Trouver l‚Äôop√©rateur s√©lectionn√© parmi les boutons
const selectedButton = document.querySelector(".operator-btn.selected");
const operator = selectedButton ? selectedButton.dataset.operator : "="; // Par d√©faut "=" si aucun s√©lectionn√©

	
	console.log(`Filtrage sur ${attribute} ${operator} ${value}`);
   
	const subgraph = new graphology.Graph();
	const numericValue = parseFloat(value); // Convertir la valeur en nombre
   
   
    // üìå R√©cup√©rer la valeur du filtre sur l'ann√©e de naissance
    const yearValue = document.getElementById('year-input').value;

    if (yearValue) {  // V√©rifie que le champ n'est pas vide
        const numericYear = parseFloat(yearValue); // Convertir en nombre
 
        renderer.getGraph().forEachNode((nodeId, attributes) => {
		
           // const birthYear = parseFloat(attributes.attributes?.["Ann√©e de naissance"]); // R√©cup√©rer la valeur du n≈ìud
			const birthYear = parseFloat(
    attributes.birthYear ||  // üìå V√©rifie directement si birthYear est une propri√©t√© du n≈ìud
    attributes.attributes?.["Ann√©e de naissance"] ||  // üìå V√©rifie dans attributes (au cas o√π)
    attributes.label?.split(" ")[0] // üìå Cherche l‚Äôann√©e au d√©but du label si elle y est
);

			
//console.log (birthYear);
            if (!isNaN(birthYear)) { // V√©rifier que la date de naissance est valide
                if ((operator === "=" && birthYear == numericYear) ||
                    (operator === ">" && birthYear > numericYear) ||
                    (operator === "<" && birthYear < numericYear)) {
                    subgraph.addNode(nodeId, { ...attributes });
                }
            }
        });
   
   
   
   
    }

    // üìå Filtrer les n≈ìuds existants en fonction de l‚Äôattribut s√©lectionn√©
    renderer.getGraph().forEachNode((nodeId, attributes) => {
        const nodeValue = parseFloat(attributes.attributes?.[attribute]); // R√©cup√®re l'attribut du n≈ìud

        if (!isNaN(nodeValue)) {
            if ((operator === "=" && nodeValue == numericValue) ||
                (operator === ">" && nodeValue > numericValue) ||
                (operator === "<" && nodeValue < numericValue)) {
                subgraph.addNode(nodeId, { ...attributes });
            }
        }
    });

    // üìå Filtrer les ar√™tes associ√©es aux n≈ìuds s√©lectionn√©s
    renderer.getGraph().forEachEdge((edgeId, attributes, source, target) => {
        if (subgraph.hasNode(source) && subgraph.hasNode(target)) {
            subgraph.addEdge(source, target, { ...attributes });
        }
    });

    console.log(`Nombre de n≈ìuds trouv√©s : ${subgraph.order}`);
    console.log(`Nombre d'ar√™tes trouv√©es : ${subgraph.size}`);

    if (subgraph.order === 0) {
        alert(`Aucun √©l√©ment trouv√©.`);
        return;
    }

    // üìå Afficher uniquement le sous-graphe correspondant
    if (renderer) {
        renderer.kill(); // ‚úÖ Supprimer l'ancien graphe pour √©viter les conflits
    }

    const container = document.getElementById('sigma-container');
    container.innerHTML = ''; // Efface le graphe pr√©c√©dent

    // ‚úÖ Cr√©ation d'un nouveau rendu Sigma.js avec le sous-graphe filtr√©
    renderer = new window.Sigma(subgraph, container, {
        labelSize: 12,
        labelSizeRatio: 3.0,
        labelThreshold: 0,
        renderLabels: true,
        labelRenderedSizeThreshold: 0,
        labelDensity: 0.7,
    });

    // ‚úÖ Ajustement dynamique des labels en fonction du zoom
    renderer.getCamera().on("updated", () => {
        const zoomLevel = renderer.getCamera().ratio;
        const newLabelSize = Math.max(10, 20 / zoomLevel);
        subgraph.forEachNode((nodeId) => {
            subgraph.setNodeAttribute(nodeId, "labelSize", newLabelSize);
        });

        renderer.refresh();
    });

    // ‚úÖ Afficher le bouton de retour au graphe des voisins
   if (lastNeighborsGraph) {

   document.getElementById("reset-neighbors-graph").style.display = "block";
    }

    renderer.refresh();

    // ‚úÖ R√©attacher les √©v√©nements pour permettre le survol et le clic
    attachEventListeners();
    attachHoverEvents();

   
   
   
	
} ///FIN DE filterGraph //////////////////////////////////////////////////


// Associer les boutons de filtrage aux fonctions correspondantes

document.getElementById("filter-modularity").addEventListener("click", () => {
    const value = document.getElementById("modularity-class-input").value.trim();
    filterGraph("Modularity Class", value);
});

document.getElementById("filter-degree-total").addEventListener("click", () => {
    const value = document.getElementById("degree-total-input").value.trim();
    filterGraph("Degr√©", value);
});

document.getElementById("filter-degree-in").addEventListener("click", () => {
    const value = document.getElementById("degree-in-input").value.trim();
    filterGraph("Degr√© Entrant", value);
});

document.getElementById("filter-degree-out").addEventListener("click", () => {
    const value = document.getElementById("degree-out-input").value.trim();
    filterGraph("Degr√© Sortant", value);
});

document.getElementById("filter-year").addEventListener("click", () => {
    const value = document.getElementById("year-input").value.trim();
    filterGraph("Ann√©e", value);
});
	
	
	
	
	
/////// √âCOUTEUR POUR LES CLICS SUR LES N≈íUDS
	renderer.on('clickNode', (event) => {
	
	// Obtenir le label du n≈ìud
                const clickedNodeLabel = renderer.graph.getNodeAttribute(event.node, 'label');
				console.log ("node cliqu√© = ", event.node);
	
	// üìå Mise √† jour du cadre d√©di√© √† l'affichage du philosophe
			const philosopherInfoElement = document.getElementById('philosopher-info');

		// üí° Supprimer l'ann√©e du label
			const cleanedLabel = clickedNodeLabel.replace(/^\d+\s*/, ""); 

			// üîç V√©rifications console
			console.log("Label nettoy√© :", cleanedLabel);
			console.log("URL Wikipedia :", `https://fr.wikipedia.org/wiki/${encodeURIComponent(cleanedLabel)}`);

   // if (cleanedLabel) {
        // üõ† Cr√©ation du lien Wikip√©dia
        const wikiLink = document.createElement("a");
        wikiLink.href = `https://fr.wikipedia.org/wiki/${encodeURIComponent(cleanedLabel)}`;
        wikiLink.target = "_blank"; // Ouvre dans un nouvel onglet
        wikiLink.textContent = cleanedLabel;
        
        // ‚úÖ Appliquer des styles au lien
        wikiLink.style.color = "red";
        wikiLink.style.fontSize = "22px";
        wikiLink.style.fontWeight = "bold";
        wikiLink.style.textDecoration = "none";

        // üèõ Ajout de l'ic√¥ne Wikip√©dia
        const wikiIcon = document.createElement("img");
        wikiIcon.src = "https://upload.wikimedia.org/wikipedia/commons/6/63/Wikipedia-logo.png";
        wikiIcon.alt = "Wikipedia";
        wikiIcon.style.width = "18px";
        wikiIcon.style.height = "18px";
        wikiIcon.style.marginLeft = "8px";
        wikiIcon.style.verticalAlign = "middle";

        wikiLink.appendChild(wikiIcon); // Ajoute l'ic√¥ne au lien

        // ‚úÖ Met √† jour le cadre `#philosopher-info` sans toucher "Voisins de :"
       


	   philosopherInfoElement.innerHTML = "";  // Efface le contenu pr√©c√©dent
     

	   philosopherInfoElement.appendChild(wikiLink); // Ajoute le lien dans le cadre
	
	
	
				
			// Appeler la fonction displaySubgraph  
				displaySubgraph(event.node);
				
			// appel de la fonction listevoisins
			    listevoisins(event.node, maingraph);
						
	}) ; //////// FIN DE √âCOUTEUR POUR LES CLICS SUR LES N≈íUDS
	
		
		 // ecouteur pour les Clic sur le fond du subgraphe pour r√©afficher le maingraph
	     //  renderer.on('clickStage', () => {location.reload();});  PAS AU POINT
			
		
		
	
///////////////////////////////////////////////////////////////////
// FONCTION POUR CREER LE GRAPHE DES NOEUDS AYANT LE MEME ATTRIBUT
	
// FIN DE LA FONCTION createSubgraphByAttribute


	// FONCTION AFFICHAGE DES NOEUDS ET ARETES DU GRAPHE PAR ATTRIBUT ET VALEUR
	 // FIN DE LA FONCTION SELECTION DES NOEUDS ET ARETES DU GRAPHE PAR ATTRIBUT


	// FONCTION POUR APPLIQUER LE FILTRE VIA L'INTERFACE UTILISATEUR
	// LA FONCTION APPLYFILTER EST APPEL√âE DANS LE BOUTON "AFFICHER LE SOUS GRAPHE"
	
	// Attacher explicitement la fonction √† l'objet global
        window.applyFilter = function applyFilter() 
		{
            const attribute = document.getElementById('attribute').value;
            const value = document.getElementById('value').value;

            if (!attribute || !value) {
                alert('Veuillez entrer un attribut et une valeur.');
                return;
            }

            console.log(`Affichage du sous-graphe pour ${attribute} = ${value}`);
			
			filterGraph(attribute, value);
        };
	// FIN DE LA FONCTION POUR APPLIQUER LE FILTRE	


	
	// CODE POUR UTILISER LE BOUTON DE RECHERCHE D'UN NOEUD PAR SOUSCHAINE DU LABEL		
	// Gestionnaire pour la recherche du noeud par nom=label dans bouton
	
	document.getElementById("search-button").addEventListener("click", function() {
    const searchTerm = document.getElementById("node-search").value.trim().toLowerCase();
    
    const results = [];

	const searchResultsContainer = document.getElementById("search-results");

    if (!searchResultsContainer) return; // V√©rifier si la liste existe

    searchResultsContainer.innerHTML = ""; // Nettoyer la liste pr√©c√©dente
    searchResultsContainer.style.display = "block"; // Assurer l'affichage

    // Recherche dans `maingraph` pour proposer des suggestions
    maingraph.forEachNode((nodeId, attributes) => {
        if (attributes.label.toLowerCase().includes(searchTerm)) {
            results.push({ id: nodeId, label: attributes.label });
        }
    });

	if (!searchTerm) { searchResultsContainer.innerHTML = `<li style="color: red;">Saisir des caract√®res</li>`;
        return;
	}
    if (results.length === 0) {
        searchResultsContainer.innerHTML = `<li style="color: red;">Aucun r√©sultat trouv√©</li>`;
        return;
    }

    results.forEach(node => {
        const listItem = document.createElement("li");
        listItem.textContent = node.label;
        listItem.style.cursor = "pointer";
        listItem.style.padding = "5px";
        listItem.style.borderBottom = "1px solid #ccc";
        listItem.addEventListener("click", function() {
            // console.log(` S√©lection de ${node.label}, affichage du graphe et masquage de la liste.`);
			
			//  Masquer la liste apr√®s s√©lection
          
			searchResultsContainer.style.display = 'none';
			
			            
            //  Afficher le graphe et les voisins du n≈ìud cliqu√©
            afficherNoeud(node.id);
        });

        searchResultsContainer.appendChild(listItem);
    });
});// FIN DE RECHERCHE D'UN NOEUD PAR SOUSCHAINE DU LABEL


 

// AFFICHAGE GRAPHE ET LISTE DU NOEUD CLIQU√â DANS LA LISTE de resultat de la recherche
// par souschaine de caracteres
function afficherNoeud(nodeId) {
   //console.log(`Affichage du graphe et des listes de voisins pour ${nodeId}`);

	// V√©rifier si le n≈ìud existe dans le graphe initial `maingraph`
    if (!maingraph.hasNode(nodeId)) {
        console.warn(`‚ùå Le n≈ìud ${nodeId} n'existe pas dans le graphe principal.`);
        return;
	}
	else
	{
     // Met √† jour le titre de la colonne de gauche
    document.getElementById("graph-title").textContent = `Voisins de ${maingraph.getNodeAttribute(nodeId, "label")}`;

    // Met √† jour la liste des voisins en utilisant `maingraph`
    listevoisins(nodeId, maingraph); 

    // Affiche le sous-graphe depuis `maingraph`
    displaySubgraph(nodeId, maingraph);
	 }
} //FIN DE afficherNoeud




		} //FIN DU TRY
		catch (error) { console.error("Erreur lors de la cr√©ation du graphe:", error); }
  
	});  // FIN DU .THEN(DATA =>
		
});  // FIN DE DOCUMENT.ADDEVENTLISTENER('DOMCONTENTLOADED', 

 	 
	document.addEventListener("mousemove", (event) => {
    const infoContainer = document.getElementById("node-info");
		if (infoContainer && infoContainer.style.display === "block") {
			infoContainer.style.top = `${event.clientY + 15}px`;
			infoContainer.style.left = `${event.clientX + 15}px`;
		}
	});
	
	
	
	
document.getElementById("help-button").addEventListener("click", function() {
    document.getElementById("help-popup").style.display = "block"; // Afficher la pop-up
});

// Fermer la pop-up si on clique en dehors du cadre
document.addEventListener("click", function(event) {
    const popup = document.getElementById("help-popup");
    const popupContent = document.querySelector(".popup-content");

    // V√©rifie si l'√©l√©ment cliqu√© N'EST PAS dans la pop-up
    if (event.target === popup) {
        popup.style.display = "none"; // Cache la pop-up
    }
});

</script>

<!-- Conteneur de la pop-up -->
<div id="help-popup" class="popup-overlay">
    <div class="popup-content">
        <p>Relations d'influences entre 541 philosophes selon DBpedia, en janvier 2025.</p>
        <ul>
			<li> Cette page Web affiche le graphe des relations d'influences entre 541 philosophes,</li>
			<li> relations extraites de DBpedia avec SPARQL </li>
			<li> relations "d'influence par" (Influenceurs) et "d'influence vers" (Influenc√©s) un autre philosophe,</li>
			<li> not√©es dans DBpedia : Influenced By  et  Influenced.</li>
           		<li> Des erreurs sont possibles dans la source et dans la proc√©dure d'extraction. </li> 
			<li> ... </li>
			<li> Cliquez sur un point-philosophe du graphe pour voir ses relations d'influences</li>
			<li>sous forme de graphe et sous forme de liste. Cliquez sur le nom du philosophe en rouge pour ouvrir sa page Wikipedia.</li>
                        <li> Entrez tout ou partie du nom du philosophe √† üîçRechercher.</li>
			<li>üîç Filtrez pour s√©lectionner certains philosophes. Les filtres s'appliquent au graphe affich√©.</li>
			<li> Le filtre sur les groupes affiche des communaut√©s de philosophes plus reli√©s entre eux que vis √† vis des autres.</li>
			<li> Ces groupes ont √©t√© √©tablis selon la m√©thode de Louvain. </li>
            <li> ... </li>
		   <li> Ne pas utiliser le "Retour page pr√©c√©dente" mais revenir au graphe initial complet avec le bouton existant.</li>
			<li>  </li>
        </ul>
    </div>
</div>


</body>
</html>
